# WB Auto Bot

Автоматизированная система для работы с заказами Wildberries и обработки сообщений из чатов.

## Основные возможности

### Обработка заказов
Автоматическое обнаружение новых заказов через Marketplace API Wildberries. Для каждого заказа создается отдельная папка на Яндекс.Диске с идентификатором заказа.

### Обработка чатов
Интеллектуальный анализ сообщений из чатов Wildberries с автоматическим сопоставлением с существующими заказами. Система использует несколько методов поиска идентификаторов заказов (RID) для точного определения принадлежности сообщений.

### Автоматические ответы
Отправка приветственного сообщения покупателю с информацией о заказе (номер, дата, артикул) при первом обращении в чат.

### Сохранение медиафайлов
Автоматическая загрузка медиафайлов из чатов в соответствующие папки заказов на Яндекс.Диске. Все файлы организуются в структурированную систему папок.

### Архивация неактивных заказов
Автоматическое перемещение заказов без активности более 24 часов в отдельную папку.

## Архитектура проекта

modules/
├── base_api.py # Базовый клиент для работы с API
├── wb_marketplace_api.py # Клиент для Marketplace API Wildberries
├── wb_chat.py # Клиент для API чатов Wildberries
├── database.py # Менеджер базы данных SQLite
└── yandex_disk.py # Менеджер для работы с Яндекс.Диском


### Ключевые компоненты

**BaseAPIClient**
Базовый класс для всех API клиентов с обработкой ошибок, повторными попытками и таймаутами.

**WBMarketplaceAPI**
Специализированный клиент для получения информации о заказах через Marketplace API.

**WBChatAPI**
Клиент для работы с системой чатов Wildberries, включая получение сообщений и медиафайлов.

**DatabaseManager**
Управление локальной базой данных для отслеживания обработанных заказов и их статусов.

**YandexDiskManager**
Интеграция с Яндекс.Диском для создания папок и загрузки файлов.

## Алгоритм работы

### Поиск и сопоставление заказов
1. Получение новых заказов через Marketplace API
2. Создание папки на Яндекс.Диске с ID заказа
3. Сохранение информации о заказе в локальную базу данных

### Обработка сообщений чатов
1. Мониторинг новых сообщений в чатах
2. Многоуровневый поиск идентификаторов заказов:
   - Анализ goodCard в текущем сообщении
   - Поиск в тексте сообщения
   - Поиск в истории текущего чата
   - Кэширование идентификаторов для повторного использования
3. Сопоставление найденных идентификаторов с существующими заказами
4. Загрузка медиафайлов в соответствующие папки заказов
5. Отправка автоматического ответа покупателю

## Структура папок на Яндекс.Диске

WB_Orders/ # Активные заказы
├── 4246692977/ # Папка заказа (по ID)
│ ├── photo1.jpg
│ └── photo2.jpg
WB_Empty_Orders/ # Неактивные заказы (>24ч без ответа)


## Настройка и установка

### Требования
- Python 3.7+
- API ключ Wildberries
- Токен Яндекс.Диска

### Установка

```bash
git clone https://github.com/omega1410/wb_automatization.git
cd wb_automatization
python -m venv venv
venv\Scripts\activate
pip install -r requirements.txt

### Конфигурация
Создайте файл `.env` в корневой директории:

```env
WB_API_KEY=your_marketplace_api_key
WB_CHAT_API_KEY=your_chat_api_key
YANDEX_DISK_TOKEN=your_yandex_disk_token